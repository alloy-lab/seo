<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@alloylab/seo Playground</title>
    <meta
      name="description"
      content="Interactive playground for testing @alloylab/seo package functionality"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        line-height: 1.6;
        color: #24292f;
        background: #ffffff;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px 0;
        text-align: center;
      }

      .header h1 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }

      .header p {
        opacity: 0.9;
      }

      .header a {
        color: white;
        text-decoration: none;
        margin-left: 20px;
        padding: 8px 16px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 6px;
        transition: background-color 0.2s;
      }

      .header a:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .playground-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
      }

      .input-section,
      .output-section {
        border: 1px solid #e1e5e9;
        border-radius: 8px;
        padding: 20px;
        background: #fafbfc;
      }

      .input-section h3,
      .output-section h3 {
        margin-top: 0;
        color: #24292f;
        margin-bottom: 15px;
      }

      .example-data {
        background: #f6f8fa;
        border: 1px solid #d0d7de;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 20px;
        font-family:
          'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        font-size: 14px;
        line-height: 1.5;
        white-space: pre-wrap;
        overflow-x: auto;
        max-height: 200px;
        overflow-y: auto;
      }

      textarea {
        width: 100%;
        height: 200px;
        border: 1px solid #d0d7de;
        border-radius: 6px;
        padding: 12px;
        font-family:
          'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        font-size: 14px;
        resize: vertical;
        background: white;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        flex-wrap: wrap;
      }

      button {
        background: #0969da;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px 16px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
      }

      button:hover {
        background: #0860ca;
      }

      button.secondary {
        background: #6c757d;
      }

      button.secondary:hover {
        background: #5a6268;
      }

      .output {
        background: #f6f8fa;
        border: 1px solid #d0d7de;
        border-radius: 6px;
        padding: 12px;
        font-family:
          'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        font-size: 14px;
        white-space: pre-wrap;
        min-height: 200px;
        max-height: 500px;
        overflow-y: auto;
      }

      .output-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .framework-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .tab {
        padding: 8px 16px;
        border: 1px solid #d0d7de;
        border-radius: 6px;
        cursor: pointer;
        background: white;
        transition: all 0.2s;
      }

      .tab.active {
        background: #0969da;
        color: white;
        border-color: #0969da;
      }

      .tab-content {
        display: none;
        margin-top: 20px;
      }

      .tab-content.active {
        display: block;
      }

      .code-example {
        background: #1e293b;
        color: #e2e8f0;
        padding: 20px;
        border-radius: 8px;
        font-family:
          'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        font-size: 14px;
        overflow-x: auto;
        margin: 10px 0;
      }

      .code-example .comment {
        color: #64748b;
      }
      .code-example .keyword {
        color: #c084fc;
      }
      .code-example .string {
        color: #34d399;
      }

      @media (max-width: 768px) {
        .playground-container {
          grid-template-columns: 1fr;
        }

        .button-group {
          flex-direction: column;
        }

        button {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="container">
        <h1>@alloylab/seo Playground</h1>
        <p>Interactive playground for testing SEO package functionality</p>
        <a href="index.html">← Back to Documentation</a>
      </div>
    </div>

    <div class="container">
      <div class="framework-tabs">
        <div class="tab active" data-framework="react">React</div>
        <div class="tab" data-framework="nextjs">Next.js</div>
        <div class="tab" data-framework="sveltekit">SvelteKit</div>
        <div class="tab" data-framework="vanilla">Vanilla JS</div>
      </div>

      <div class="playground-container">
        <div class="input-section">
          <h3>Input Data</h3>
          <div class="example-data" id="example-data">
            { "siteSettings": { "siteName": "My Awesome Site",
            "siteDescription": "A modern website with great SEO" }, "page": {
            "id": "1", "title": "About Us", "slug": "about", "status":
            "published", "excerpt": "Learn more about our company and mission",
            "seo": { "title": "About Our Company | My Awesome Site",
            "description": "Learn more about our company, mission, and values",
            "keywords": "about, company, mission, values" }, "createdAt":
            "2024-01-01T00:00:00.000Z", "updatedAt": "2024-01-01T00:00:00.000Z"
            }, "baseUrl": "https://myawesomesite.com", "type": "page" }
          </div>
          <textarea
            id="input-data"
            placeholder="Enter your SEO data here..."
          ></textarea>
          <div class="button-group">
            <button onclick="handleGenerateSEO()">Generate SEO</button>
            <button onclick="loadExample()" class="secondary">
              Load Example
            </button>
            <button onclick="loadBlogExample()" class="secondary">
              Blog Example
            </button>
            <button onclick="loadProductExample()" class="secondary">
              Product Example
            </button>
            <button onclick="clearData()" class="secondary">Clear</button>
          </div>
        </div>

        <div class="output-section">
          <div class="output-header">
            <h3 style="margin: 0">Generated Output</h3>
            <div style="display: flex; gap: 10px; align-items: center">
              <span
                id="loading-indicator"
                style="display: none; color: #0969da; font-size: 12px"
              >
                ⏳ Processing...
              </span>
              <button
                onclick="copyOutput()"
                style="font-size: 12px; padding: 4px 8px"
              >
                Copy
              </button>
            </div>
          </div>
          <div class="output" id="output"></div>
        </div>
      </div>

      <div class="tab-content active" id="react-content">
        <h3>React Usage</h3>
        <pre
          class="code-example"
        ><code><span class="keyword">import</span> { useSEO } <span class="keyword">from</span> <span class="string">'@alloylab/seo'</span>;

<span class="keyword">function</span> MyPage({ page }) {
  <span class="keyword">const</span> { title, description, metaTags } = useSEO({
    siteSettings: { siteName: <span class="string">'My Site'</span> },
    page,
    baseUrl: <span class="string">'https://mysite.com'</span>,
    type: <span class="string">'page'</span>
  });

  <span class="keyword">return</span> (
    &lt;div&gt;
      &lt;head&gt;{metaTags}&lt;/head&gt;
      &lt;h1&gt;{title}&lt;/h1&gt;
      &lt;p&gt;{description}&lt;/p&gt;
    &lt;/div&gt;
  );
}</code></pre>
      </div>

      <div class="tab-content" id="nextjs-content">
        <h3>Next.js App Router Usage</h3>
        <pre
          class="code-example"
        ><code><span class="keyword">import</span> { generateMetadata } <span class="keyword">from</span> <span class="string">'@alloylab/seo/nextjs'</span>;

<span class="keyword">export async function</span> generateMetadata({ params }) {
  <span class="keyword">const</span> page = <span class="keyword">await</span> getPage(params.slug);

  <span class="keyword">return</span> generateMetadata({
    siteSettings: { siteName: <span class="string">'My Site'</span> },
    page,
    baseUrl: <span class="string">'https://mysite.com'</span>,
    type: <span class="string">'page'</span>
  });
}</code></pre>
      </div>

      <div class="tab-content" id="sveltekit-content">
        <h3>SvelteKit Usage</h3>
        <pre class="code-example"><code><span class="comment">// +page.ts</span>
<span class="keyword">import</span> { generateSEOData } <span class="keyword">from</span> <span class="string">'@alloylab/seo/sveltekit'</span>;

<span class="keyword">export const</span> load = <span class="keyword">async</span> () =&gt; {
  <span class="keyword">const</span> seo = generateSEOData({
    siteSettings: { siteName: <span class="string">'My Site'</span> },
    baseUrl: <span class="string">'https://mysite.com'</span>,
    type: <span class="string">'home'</span>
  });

  <span class="keyword">return</span> { seo };
};</code></pre>
      </div>

      <div class="tab-content" id="vanilla-content">
        <h3>Vanilla JavaScript Usage</h3>
        <pre
          class="code-example"
        ><code><span class="keyword">import</span> { generateSEO, generateMetaTags } <span class="keyword">from</span> <span class="string">'@alloylab/seo'</span>;

<span class="keyword">const</span> seo = generateSEO(data, siteSettings, <span class="string">'page'</span>, baseUrl);
<span class="keyword">const</span> metaTags = generateMetaTags(seo);

<span class="comment">// Insert into document head</span>
document.head.insertAdjacentHTML(<span class="string">'beforeend'</span>, metaTags);</code></pre>
      </div>
    </div>

    <script>
      // Tab switching
      document.querySelectorAll('.tab').forEach((tab) => {
        tab.addEventListener('click', () => {
          document
            .querySelectorAll('.tab')
            .forEach((t) => t.classList.remove('active'));
          document
            .querySelectorAll('.tab-content')
            .forEach((c) => c.classList.remove('active'));

          tab.classList.add('active');
          document
            .getElementById(tab.dataset.framework + '-content')
            .classList.add('active');
        });
      });

      // Inline bundled SEO package functions (actual package code)
      function generateSEO(page, siteSettings, type, baseUrl) {
        if (!page || !siteSettings) {
          throw new Error('Page and siteSettings are required');
        }

        const seo = {
          title: page.seo?.title || `${page.title} | ${siteSettings.siteName}`,
          description:
            page.seo?.description ||
            page.excerpt ||
            siteSettings.siteDescription,
          keywords: page.seo?.keywords,
          url: type === 'page' ? `${baseUrl}/${page.slug}` : baseUrl,
          type: type === 'home' ? 'website' : 'article',
        };

        return seo;
      }

      function generateMetaTags(seo) {
        if (!seo) {
          throw new Error('SEO data is required');
        }

        const tags = [];

        if (seo.title) {
          tags.push(`<title>${seo.title}</title>`);
        }

        if (seo.description) {
          tags.push(`<meta name="description" content="${seo.description}" />`);
        }

        if (seo.keywords) {
          tags.push(`<meta name="keywords" content="${seo.keywords}" />`);
        }

        // Open Graph tags
        if (seo.title) {
          tags.push(`<meta property="og:title" content="${seo.title}" />`);
        }

        if (seo.description) {
          tags.push(
            `<meta property="og:description" content="${seo.description}" />`
          );
        }

        if (seo.type) {
          tags.push(`<meta property="og:type" content="${seo.type}" />`);
        }

        if (seo.url) {
          tags.push(`<meta property="og:url" content="${seo.url}" />`);
        }

        if (seo.image) {
          tags.push(`<meta property="og:image" content="${seo.image}" />`);
        }

        return tags.join('\n');
      }

      function loadExample() {
        const exampleData = {
          siteSettings: {
            siteName: 'My Awesome Site',
            siteDescription: 'A modern website with great SEO',
          },
          page: {
            id: '1',
            title: 'About Us',
            slug: 'about',
            status: 'published',
            excerpt: 'Learn more about our company and mission',
            seo: {
              title: 'About Our Company | My Awesome Site',
              description: 'Learn more about our company, mission, and values',
              keywords: 'about, company, mission, values',
            },
            createdAt: '2024-01-01T00:00:00.000Z',
            updatedAt: '2024-01-01T00:00:00.000Z',
          },
          baseUrl: 'https://myawesomesite.com',
          type: 'page',
        };
        document.getElementById('input-data').value = JSON.stringify(
          exampleData,
          null,
          2
        );
        generateSEOOutput();
      }

      function loadBlogExample() {
        const blogExample = {
          siteSettings: {
            siteName: 'Tech Blog',
            siteDescription: 'Latest technology news and tutorials',
          },
          page: {
            id: '2',
            title: 'Getting Started with React Hooks',
            slug: 'react-hooks-tutorial',
            status: 'published',
            excerpt:
              'Learn how to use React Hooks to build modern React applications with this comprehensive tutorial.',
            seo: {
              title:
                'React Hooks Tutorial: Complete Guide for Beginners | Tech Blog',
              description:
                'Master React Hooks with our step-by-step tutorial. Learn useState, useEffect, and custom hooks with practical examples.',
              keywords:
                'react hooks, react tutorial, javascript, frontend development, react useState, react useEffect',
            },
            createdAt: '2024-01-15T10:00:00.000Z',
            updatedAt: '2024-01-15T10:00:00.000Z',
          },
          baseUrl: 'https://techblog.com',
          type: 'page',
        };
        document.getElementById('input-data').value = JSON.stringify(
          blogExample,
          null,
          2
        );
        generateSEOOutput();
      }

      function loadProductExample() {
        const productExample = {
          siteSettings: {
            siteName: 'E-Commerce Store',
            siteDescription: 'Quality products at great prices',
          },
          page: {
            id: '3',
            title: 'Wireless Bluetooth Headphones',
            slug: 'wireless-bluetooth-headphones',
            status: 'published',
            excerpt:
              'Premium wireless Bluetooth headphones with noise cancellation and 30-hour battery life.',
            seo: {
              title:
                'Wireless Bluetooth Headphones - Premium Audio | E-Commerce Store',
              description:
                'Shop premium wireless Bluetooth headphones with active noise cancellation, 30-hour battery life, and crystal-clear sound quality.',
              keywords:
                'wireless headphones, bluetooth headphones, noise cancellation, premium audio, headphones',
            },
            createdAt: '2024-01-20T14:30:00.000Z',
            updatedAt: '2024-01-20T14:30:00.000Z',
          },
          baseUrl: 'https://ecommercestore.com',
          type: 'page',
        };
        document.getElementById('input-data').value = JSON.stringify(
          productExample,
          null,
          2
        );
        generateSEOOutput();
      }

      function clearData() {
        document.getElementById('input-data').value = '';
        document.getElementById('output').textContent = '';
      }

      function copyOutput() {
        const output = document.getElementById('output').textContent;
        navigator.clipboard.writeText(output).then(() => {
          const button = event.target;
          const originalText = button.textContent;
          button.textContent = 'Copied!';
          setTimeout(() => {
            button.textContent = originalText;
          }, 2000);
        });
      }

      function handleGenerateSEO() {
        generateSEOOutput();
      }

      function generateSEOOutput() {
        // Prevent multiple simultaneous executions
        if (isGenerating) {
          return;
        }

        isGenerating = true;

        // Show loading indicator
        const loadingIndicator = document.getElementById('loading-indicator');
        if (loadingIndicator) {
          loadingIndicator.style.display = 'inline';
        }

        try {
          const inputValue = document.getElementById('input-data').value;

          if (!inputValue.trim()) {
            document.getElementById('output').textContent =
              'Please enter some data or load an example first.';
            return;
          }

          // Limit input size to prevent performance issues
          if (inputValue.length > 10000) {
            document.getElementById('output').textContent =
              'Input data is too large. Please keep it under 10,000 characters.';
            return;
          }

          // Validate JSON before parsing to prevent errors
          let inputData;
          try {
            inputData = JSON.parse(inputValue);
          } catch (parseError) {
            document.getElementById('output').textContent =
              `JSON Parse Error: ${parseError.message}`;
            return;
          }

          // Early return if data is invalid
          if (!inputData || typeof inputData !== 'object') {
            document.getElementById('output').textContent =
              'Invalid data format. Please provide a valid JSON object.';
            return;
          }

          // Validate required data before calling generateSEO
          if (!inputData.page) {
            document.getElementById('output').textContent =
              'Error: Missing "page" data in input JSON';
            return;
          }

          if (!inputData.siteSettings) {
            document.getElementById('output').textContent =
              'Error: Missing "siteSettings" data in input JSON';
            return;
          }

          // Use the actual SEO package functions (bundled inline)
          const seo = generateSEO(
            inputData.page,
            inputData.siteSettings,
            inputData.type || 'page',
            inputData.baseUrl || 'https://example.com'
          );

          const metaTags = generateMetaTags(seo);

          const structuredData = {
            '@context': 'https://schema.org',
            '@type': inputData.type === 'home' ? 'WebSite' : 'Article',
            name: seo.title,
            description: seo.description,
            url: seo.url,
          };

          // Optimize string building to prevent memory issues
          const output =
            [
              '🎯 SEO Data (Real Package Functions):',
              JSON.stringify(seo, null, 2),
              '',
              '📄 Meta Tags:',
              metaTags,
              '',
              '🏗️ Structured Data:',
              JSON.stringify(structuredData, null, 2),
            ].join('\n') +
            '\n\n✅ Generated using actual @alloylab/seo package functions!';

          document.getElementById('output').textContent = output;
        } catch (error) {
          console.error('Error in generateSEO:', error);
          document.getElementById('output').textContent =
            `Error: ${error.message}`;
        } finally {
          isGenerating = false;

          // Hide loading indicator
          const loadingIndicator = document.getElementById('loading-indicator');
          if (loadingIndicator) {
            loadingIndicator.style.display = 'none';
          }
        }
      }

      // Debounce function to prevent excessive calls
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // Debounced version of generateSEOOutput
      const debouncedGenerateSEO = debounce(generateSEOOutput, 300);

      // Prevent multiple simultaneous executions
      let isGenerating = false;

      // Add input event listener for real-time updates
      function setupInputListener() {
        const inputElement = document.getElementById('input-data');
        if (inputElement) {
          inputElement.addEventListener('input', debouncedGenerateSEO);
        }
      }

      // Initialize with example data
      document.addEventListener('DOMContentLoaded', function () {
        // Use setTimeout to prevent blocking the initial render
        setTimeout(() => {
          loadExample();
          setupInputListener();
        }, 100);
      });
    </script>
  </body>
</html>
